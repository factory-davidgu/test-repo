name: Droid PR Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review-pr:
    runs-on: ubuntu-latest
    environment: droid
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch full history to analyze PR changes
      
      - name: Install Droid CLI
        run: |
          curl -fsSL https://app.factory.ai/cli | sh
          echo "/usr/local/bin" >> $GITHUB_PATH
      
      - name: Verify Droid CLI installation
        run: |
          droid --version
      
      - name: Run Droid exec to review PR
        env:
          FACTORY_API_KEY: ${{ secrets.FACTORY_API_KEY }}
        run: |
          droid exec "Review this pull request for code quality, security issues, and best practices. Analyze the changes in ${{ github.event.pull_request.html_url }} and provide specific feedback including: 1) Code quality assessment, 2) Potential bugs or issues, 3) Security considerations, 4) Suggestions for improvement, 5) Best practices alignment. Focus on the files changed in this PR."
      
      - name: Display review completion
        run: |
          echo "âœ… Droid PR review completed successfully for ${{ github.event.pull_request.html_url }}"
